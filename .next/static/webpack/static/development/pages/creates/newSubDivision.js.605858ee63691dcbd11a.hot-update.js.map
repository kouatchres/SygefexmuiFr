{"version":3,"file":"static/webpack/static\\development\\pages\\creates\\newSubDivision.js.605858ee63691dcbd11a.hot-update.js","sources":["webpack:///./src/components/subDivision/NewSubDivision.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport Error from \"../ErrorMessage.js\";\r\nimport * as Yup from \"yup\";\r\nimport { TextField } from \"material-ui-formik-components/TextField\";\r\nimport { Select } from \"material-ui-formik-components/Select\";\r\nimport { ErrorMessage, Formik, Form, Field } from \"formik\";\r\nimport {\r\n  Grid,\r\n  Typography,\r\n  Paper,\r\n  Button,\r\n  MenuItem,\r\n  LinearProgress,\r\n  CircularProgress,\r\n} from \"@material-ui/core\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport useForm from \"../utils/useForm\";\r\nimport SygefexMuiInput from \"../muiComponents/controls/SygefexMuiInput\";\r\nimport SygefexMuiSelect from \"../muiComponents/controls/SygefexMuiSelect\";\r\nimport { useMutation, useApolloClient, useQuery } from \"@apollo/react-hooks\";\r\nimport {\r\n  getDivisionsOfARegionQuery,\r\n  getAllRegionsQuery,\r\n} from \"../queries&Mutations&Functions/Queries\";\r\nimport { getObjectFromID } from \"../queries&Mutations&Functions/Functions\";\r\nimport { createSubDivisionMutation } from \"../queries&Mutations&Functions/Mutations\";\r\n\r\nconst useStyles = makeStyles({\r\n  root: {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    // fontSize: 100,\r\n  },\r\n  divStyled: {\r\n    display: \"grid\",\r\n    placeItems: \"center\",\r\n    top: \"2rem\",\r\n    height: \"90vh\",\r\n  },\r\n  pageStyled: {\r\n    display: \"grid\",\r\n    placeItems: \"center\",\r\n    marginTop: \"2rem\",\r\n    padding: \"1rem\",\r\n    minWidth: \"30vw\",\r\n  },\r\n  listStyled: {\r\n    display: \"grid\",\r\n    placeItems: \"center\",\r\n    listStyleType: \"none\",\r\n    margin: 0,\r\n    padding: 0,\r\n    paddingTop: \"0.1rem\",\r\n  },\r\n  titleStyled: {\r\n    display: \"grid\",\r\n    placeItems: \"center\",\r\n  },\r\n\r\n  allControls: {\r\n    display: \"grid\",\r\n    placeItems: \"center\",\r\n    paddingTop: \"0.2rem\",\r\n    border: \"0.05rem solid #1254ac\",\r\n    // width: \"20vw\",\r\n    borderRadius: \"0.5rem\",\r\n    // marginTop: \"2rem\",\r\n  },\r\n  centerAll: {\r\n    display: \"grid\",\r\n    placeItems: \"center\",\r\n    minWidth: \"30vw\",\r\n  },\r\n});\r\n\r\nconst validationSchema = Yup.object().shape({\r\n  regionID: Yup.object().required(\"Choissisez une région\"),\r\n  division: Yup.string().required(\"Choissisez un département\"),\r\n  subDivName: Yup.string().required(\"Nom arrondissement Obligatoire\"),\r\n  subDivCode: Yup.string().required(\"Code arrondissement Obligatoire\"),\r\n});\r\n\r\nconst NewSubDivision = () => {\r\n  const classes = useStyles();\r\n  const client = useApolloClient();\r\n  const [regions, setRegions] = useState([]);\r\n  const [divisions, setDivisions] = useState([]);\r\n  const [regionID, setRegionID] = useState(\"\");\r\n\r\n  const initialValues = {\r\n    subDivName: \"\",\r\n    subDivCode: \"\",\r\n    division: \"\",\r\n    regionID: \"\",\r\n  };\r\n  const handleRegionIDChange = (e) => {\r\n    console.log(e.target);\r\n    setRegionID(e.target.value);\r\n  };\r\n  const loadRegionData = async () => {\r\n    const { error, data, loading } = await client.query({\r\n      query: getAllRegionsQuery,\r\n    });\r\n    console.log(data.regions);\r\n\r\n    setRegions(data.regions);\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadRegionData();\r\n  }, []);\r\n  console.log({ regionID });\r\n  // const refinedRegion = removeTypename(regions)\r\n  const getRegionsOptions =\r\n    regions && regions.map((item) => ({ value: item.id, label: item.regName }));\r\n\r\n  const loadDivisionData = async () => {\r\n    const { error, data } = await client.query({\r\n      // skip: regionID && !regionID,\r\n      query: getDivisionsOfARegionQuery,\r\n      variables: { id: regionID },\r\n    });\r\n    console.dir(data)\r\n    const { division } = {...data.region};\r\n    console.log(division);\r\n    setDivisions(division);\r\n  };\r\n\r\n  useEffect(() => {\r\n    loadDivisionData();\r\n  }, [regionID]);\r\n\r\n  console.log(divisions);\r\n  const getRegion = divisions && divisions.region;\r\n  const { division } = { ...getRegion };\r\n  console.log(division);\r\n  const getDivOptions =\r\n    divisions &&\r\n    divisions.map((item) => ({ value: item, label: item.subDivName }));\r\n\r\n  console.dir(getDivOptions);\r\n  const [createSubDivision, { loading, error }] = useMutation(\r\n    createSubDivisionMutation,\r\n    {\r\n      refetchQueries: [\"getAllSubDivisionsQuery\"],\r\n    }\r\n  );\r\n\r\n  return (\r\n    <Formik\r\n      method=\"POST\"\r\n      initialValues={initialValues}\r\n      validationSchema={validationSchema}\r\n      onSubmit={async (values, { setSubmitting, resetForm }) => {\r\n        const res = await createSubDivision({\r\n          variables: {\r\n            ...values,\r\n            division: values.division && getObjectFromID(values.division.id),\r\n          },\r\n        });\r\n        setTimeout(() => {\r\n          console.log(JSON.stringify(values, null, 2));\r\n          console.log(res);\r\n          resetForm(true);\r\n          setSubmitting(false);\r\n        }, 400);\r\n      }}\r\n    >\r\n      {({ submitForm, setFieldValue, isSubmitting }) => {\r\n        return (\r\n          <div className={classes.centerAll}>\r\n            <Paper className={classes.pageStyled} elevation={3}>\r\n              <Form aria-busy={isSubmitting}>\r\n                {(isSubmitting || loading) && <LinearProgress />}\r\n                <Grid className={classes.centerAll} container>\r\n                  <Grid container className={classes.centerAll}>\r\n                    <Grid item>\r\n                      <Error error={error} />\r\n                      <Typography\r\n                        className={classes.titleStyled}\r\n                        variant=\"body1\"\r\n                      >\r\n                        Nouvel Arrondissement\r\n                      </Typography>\r\n                    </Grid>\r\n                  </Grid>\r\n                  <Grid container className={classes.centerAll}>\r\n                    <Grid item className={classes.centerAll}>\r\n                      <Field\r\n                        variant=\"outlined\"\r\n                        name=\"regionID\"\r\n                        label=\"La Région\"\r\n                        onChange={handleRegionIDChange}\r\n                        component={Select}\r\n                        // placeholder=\"la Région\"\r\n                        disabled={isSubmitting}\r\n                        helperText={<ErrorMessage name=\"regionID\" />}\r\n                        options={getRegionsOptions}\r\n                        fullWidth\r\n                      />\r\n                      <Field\r\n                        variant=\"outlined\"\r\n                        name=\"division\"\r\n                        label=\"Le Département\"\r\n                        component={Select}\r\n                        placeholder=\"le Département\"\r\n                        disabled={isSubmitting}\r\n                        helperText={<ErrorMessage name=\"division\" />}\r\n                        options={getRegionsOptions}\r\n                        fullWidth\r\n                      />\r\n\r\n                      <Field\r\n                        name=\"subDivName\"\r\n                        type=\"text\"\r\n                        component={TextField}\r\n                        label=\"Nom Arrondissement\"\r\n                        fullWidth\r\n                        variant=\"standard\"\r\n                        disabled={isSubmitting || loading}\r\n                        helperText={<ErrorMessage name=\"subDivName\" />}\r\n                      />\r\n                      <Field\r\n                        name=\"subDivCode\"\r\n                        type=\"text\"\r\n                        component={TextField}\r\n                        label=\"Code Arrondissement\"\r\n                        fullWidth\r\n                        variant=\"standard\"\r\n                        disabled={isSubmitting || loading}\r\n                        helperText={<ErrorMessage name=\"subDivCode\" />}\r\n                      />\r\n                      <Button disabled={isSubmitting} onClick={submitForm}>\r\n                        Valid{isSubmitting ? \"ation en cours\" : \"er\"}\r\n                      </Button>\r\n                    </Grid>\r\n                  </Grid>\r\n                </Grid>\r\n              </Form>\r\n            </Paper>\r\n          </div>\r\n        );\r\n      }}\r\n    </Formik>\r\n  );\r\n};\r\nexport default NewSubDivision;\r\n//  <SygefexMuiSelect\r\n//    variant=\"standard\"\r\n//    name=\"division\"\r\n//    label=\"Le Département\"\r\n//    placeholder=\"Le Département\"\r\n//    disabled={isSubmitting}\r\n//    options={getDivOptions}\r\n//    helperText={<ErrorMessage name=\"division\" />}\r\n//  />;\r\n// //\r\n\r\n// <SygefexMuiSelect\r\n//   variant=\"standard\"\r\n//   name=\"division\"\r\n//   label=\"Le Département\"\r\n//   placeholder=\"Le Département\"\r\n//   disabled={isSubmitting}\r\n//   options={getDivOptions}\r\n//   helperText={<ErrorMessage name=\"division\" />}\r\n// />\r\n\r\n// <SygefexMuiSelect\r\n//   variant=\"standard\"\r\n//   name=\"division\"\r\n//   label=\"Le Département\"\r\n//   placeholder=\"Le Département\"\r\n//   disabled={isSubmitting}\r\n//   helperText={<ErrorMessage name=\"division\" />}\r\n// >\r\n//   {division &&\r\n//     division.map((item) => (\r\n//       <MenuItem value={item.id} key={item.id}>\r\n//         {item.divName}\r\n//       </MenuItem>\r\n//     ))}\r\n// </SygefexMuiSelect>\r\n\r\n// <Field\r\n//   component={TextField}\r\n//   select\r\n//   name=\"regionD\"\r\n//   disabled={isSubmitting}\r\n//   helperText=\"region\"\r\n// >\r\n//   {regions &&\r\n//     regions.map((item) => (\r\n//       <MenuItem key={item.id} value={item.id}>\r\n//         {item.regName}\r\n//       </MenuItem>\r\n//     ))}\r\n// </Field>;\r\n\r\n// <Field\r\n//   variant=\"standard\"\r\n//   disabled={isSubmitting}\r\n//   fullWidth\r\n//   placeholder=\"Le Département\"\r\n//   name=\"division\"\r\n//   label=\"Département\"\r\n//   options={getDivOptions}\r\n//   component={Select}\r\n//   helperText={<ErrorMessage name=\"region\" />}\r\n// />\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AASA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AAEA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AAFA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AACA;AACA;AAHA;AAzCA;AAgDA;AACA;AACA;AACA;AACA;AAJA;AACA;AAMA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAMA;AACA;AACA;AACA;AACA;AAJA;AACA;AAKA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AADA;AACA;AAFA;AAAA;AACA;AAAA;AAAA;AAGA;AAEA;AACA;AAPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAQA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAHA;AACA;AAFA;AAAA;AACA;AAAA;AAKA;AANA;AAQA;AACA;AACA;AAVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AAWA;AACA;AACA;AAEA;AACA;AACA;AApDA;AAAA;AACA;AAoDA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AA3DA;AA8DA;AADA;AA7DA;AAAA;AAAA;AAAA;AAAA;AACA;AAiEA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AAFA;AADA;AACA;AAFA;AACA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAmBA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AATA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AARA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AAGA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}